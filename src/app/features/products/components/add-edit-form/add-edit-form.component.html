<!-- Dialog Header -->
<div class="dialog-header">
    <div class="header-content">
        <h2 class="dialog-title">
            <mat-icon class="title-icon">{{dialogData?.action === 'Editar' ? 'edit' : 'add_circle'}}</mat-icon>
            {{dialogData?.action === 'Editar' ? 'Editar Producto' : 'Agregar Producto'}}
        </h2>
        <button mat-icon-button class="close-button" mat-dialog-close aria-label="Cerrar">
            <mat-icon>close</mat-icon>
        </button>
    </div>
</div>

<!-- Dialog Content -->
<mat-dialog-content class="dialog-content">
    <form [formGroup]="productForm" (ngSubmit)="handleSubmit()" class="product-form">
        <div class="form-grid">
            <!-- Product Name -->
            <div class="form-field-wrapper form-field-full">
                <label class="field-label">Nombre del Producto<span class="required-asterisk">*</span></label>
                <mat-form-field appearance="outline" class="form-field-full">
                    <input matInput type="text" formControlName="name" placeholder="Nombre del Producto*" required>
                    <mat-icon matPrefix>inventory_2</mat-icon>
                    <mat-error *ngIf="productForm.controls['name'].touched && productForm.controls['name'].invalid">
                        <span *ngIf="productForm.controls['name'].errors?.['required']">Este campo es requerido</span>
                    </mat-error>
                </mat-form-field>
            </div>

            <!-- Description -->
            <div class="form-field-wrapper form-field-full description-field">
                <label class="field-label">Descripción<span class="required-asterisk">*</span></label>
                <mat-form-field appearance="outline" class="form-field-full">
                    <div class="textarea-wrapper">
                        <mat-icon matPrefix>description</mat-icon>
                        <textarea 
                            matInput 
                            formControlName="description" 
                            rows="3" 
                            placeholder="Detalle del producto" 
                            required
                            cdkTextareaAutosize
                            cdkAutosizeMinRows="3"
                            cdkAutosizeMaxRows="10">
                        </textarea>
                    </div>
                    <mat-error *ngIf="productForm.controls['description'].touched && productForm.controls['description'].invalid">
                        <span *ngIf="productForm.controls['description'].errors?.['required']">Este campo es requerido</span>
                    </mat-error>
                </mat-form-field>
            </div>

            <!-- Category -->
            <div class="form-field-wrapper form-field-half">
                <label class="field-label">Categoría<span class="required-asterisk">*</span></label>
                <mat-form-field appearance="outline" class="form-field-half">
                    <mat-icon matPrefix>category</mat-icon>
                    <mat-select 
                        formControlName="category" 
                        panelClass="custom-select-panel" 
                        [disableOptionCentering]="true"
                        required>
                        <mat-option *ngFor="let category of productsCategories" [value]="category.id">
                            {{category.name}}
                        </mat-option>
                        <mat-option *ngIf="productsCategories.length === 0" disabled>
                            No hay categorías disponibles ({{productsCategories.length}})
                        </mat-option>
                    </mat-select>
                    <mat-hint *ngIf="productsCategories.length > 0">{{productsCategories.length}} categorías disponibles</mat-hint>
                    <mat-error *ngIf="productForm.controls['category'].touched && productForm.controls['category'].invalid">
                        <span *ngIf="productForm.controls['category'].errors?.['required']">Este campo es requerido</span>
                    </mat-error>
                </mat-form-field>
            </div>

            <!-- Stock -->
            <div class="form-field-wrapper form-field-half">
                <label class="field-label">Stock<span class="required-asterisk">*</span></label>
                <mat-form-field appearance="outline" class="form-field-half">
                    <input matInput type="number" min="0" step="1" formControlName="stock" placeholder="Stock*" required (input)="onNumberInput($event, 'stock')">
                    <mat-icon matPrefix>inventory</mat-icon>
                    <mat-error *ngIf="productForm.controls['stock'].touched && productForm.controls['stock'].invalid">
                        <span *ngIf="productForm.controls['stock'].errors?.['required']">Este campo es requerido</span>
                        <span *ngIf="productForm.controls['stock'].errors?.['min']">El stock no puede ser negativo</span>
                        <span *ngIf="productForm.controls['stock'].errors?.['integer']">El stock debe ser un número entero</span>
                        <span *ngIf="productForm.controls['stock'].errors?.['invalidFormat']">Formato inválido</span>
                    </mat-error>
                </mat-form-field>
            </div>

            <!-- Cost Price -->
            <div class="form-field-wrapper form-field-half price-field">
                <label class="field-label">Precio de Compra<span class="required-asterisk">*</span></label>
                <mat-form-field appearance="outline" class="form-field-half">
                    <input matInput type="number" min="0" step="0.01" formControlName="cost_price" placeholder="Precio de Compra*" required (input)="onNumberInput($event, 'cost_price')">
                    <span matPrefix class="currency-icon">C$</span>
                    <mat-error *ngIf="productForm.controls['cost_price'].touched && productForm.controls['cost_price'].invalid">
                        <span *ngIf="productForm.controls['cost_price'].errors?.['required']">Este campo es requerido</span>
                        <span *ngIf="productForm.controls['cost_price'].errors?.['min']">El precio no puede ser negativo</span>
                        <span *ngIf="productForm.controls['cost_price'].errors?.['decimalPlaces']">El precio puede tener máximo 2 decimales</span>
                        <span *ngIf="productForm.controls['cost_price'].errors?.['invalidFormat']">Formato inválido</span>
                    </mat-error>
                </mat-form-field>
            </div>

            <!-- Sale Price -->
            <div class="form-field-wrapper form-field-half price-field">
                <label class="field-label">Precio de Venta<span class="required-asterisk">*</span></label>
                <mat-form-field appearance="outline" class="form-field-half">
                    <input matInput type="number" min="0" step="0.01" formControlName="sale_price" placeholder="Precio de Venta*" required (input)="onNumberInput($event, 'sale_price')">
                    <span matPrefix class="currency-icon">C$</span>
                    <mat-error *ngIf="productForm.controls['sale_price'].touched && productForm.controls['sale_price'].invalid">
                        <span *ngIf="productForm.controls['sale_price'].errors?.['required']">Este campo es requerido</span>
                        <span *ngIf="productForm.controls['sale_price'].errors?.['min']">El precio no puede ser negativo</span>
                        <span *ngIf="productForm.controls['sale_price'].errors?.['decimalPlaces']">El precio puede tener máximo 2 decimales</span>
                        <span *ngIf="productForm.controls['sale_price'].errors?.['invalidFormat']">Formato inválido</span>
                    </mat-error>
                </mat-form-field>
            </div>
        </div>
    </form>
</mat-dialog-content>

<!-- Dialog Actions -->
<mat-dialog-actions class="dialog-actions">
    <button mat-stroked-button type="button" mat-dialog-close class="cancel-button">
        <mat-icon>close</mat-icon>
        Cancelar
    </button>
    <button mat-raised-button type="submit" (click)="handleSubmit()" class="save-button" [disabled]="productForm.invalid">
        <mat-icon>{{dialogData?.action === 'Editar' ? 'update' : 'save'}}</mat-icon>
        {{action}}
    </button>
</mat-dialog-actions>
