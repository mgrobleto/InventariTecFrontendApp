<mat-dialog-content class="invoice-modal-content">
  <div class="invoice-paper" id="quoteData">
    <!-- Top Decoration -->
    <div class="header-decoration"></div>

    <!-- Header Section -->
    <div class="paper-header">
      <div class="header-left">
        <div class="invoice-number">Ref. {{data?.invoice_number}}</div>
        <div class="invoice-date">{{ data?.created_at | date:'dd' }} DE {{ data?.created_at | date:'MMMM' | uppercase }} DE {{ data?.created_at | date:'yyyy' }}</div>
      </div>
      <div class="header-right">
        <h1 class="document-title">COTIZACIÓN</h1>
      </div>
    </div>

    <!-- Info Section -->
    <div class="info-details-container">
      <div class="info-column">
        <h3 class="column-label">COTIZACIÓN PARA</h3>
        <p class="name">{{data?.customer_name}}</p>
        <p class="details" *ngIf="data?.customer_address">{{data?.customer_address}}</p>
        <p class="details" *ngIf="data?.customer_phone">Tel: {{data?.customer_phone}}</p>
      </div>

      <div class="info-column align-right">
        <h3 class="column-label">EMPRESA</h3>
        <p class="name">{{data?.company_name}}</p>
        <p class="company-name">TECNOREFILL</p>
        <p class="details">Colonia Linda Vista 2 1/2 c. al sur, 35 Avenida</p>
        <p class="details">Tel. 88975535 · Tigo 86087337</p>
      </div>
    </div>

    <!-- Table Section -->
    <div class="table-section">
      <table class="custom-table">
        <thead>
          <tr>
            <th class="desc-col">Descripción</th>
            <th class="qty-col">Cant.</th>
            <th class="price-col">Precio</th>
            <th class="total-col">Total</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of dataSource.data">
            <td class="desc-col">
              <span *ngIf="item.product_name">{{item.product_name}}</span>
              <span *ngIf="!item.product_name && item.description">{{item.description}}</span>
            </td>
            <td class="qty-col">{{item.quantity}}</td>
            <td class="price-col">{{item.cost_price_at_time | currency:'NIO':'symbol-narrow'}}</td>
            <td class="total-col">{{item.sale_price_at_time | currency:'NIO':'symbol-narrow'}}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Visual separation/Spacing -->
    <div style="flex-grow: 1;"></div>

    <!-- Bottom Section: Payment & Totals -->
    <div class="bottom-section">
      <div class="payment-info">
        <h3>METODO DE PAGO</h3>
        <p *ngIf="data?.payment_method">
            <strong>Tipo:</strong> {{data?.payment_method}}
        </p>
        <p>Cuenta: 0123 4567 8901</p> <!-- TODO: Dynamic? -->
        <p>Tarjeta: 0123 4567 8901 2345</p>
      </div>
      
      <div class="totals-box">
        <div class="summary-row">
          <span>Subtotal</span>
          <span>{{data?.sub_total | currency:'NIO':'symbol-narrow'}}</span>
        </div>
        <div class="summary-row">
          <span>IVA</span>
          <span>{{(data?.iva || 0) | currency:'NIO':'symbol-narrow'}}</span>
        </div>
        <div class="summary-total">
          <span>TOTAL</span>
          <span>{{data?.total | currency:'NIO':'symbol-narrow'}}</span>
        </div>
      </div>
    </div>

    <!-- Signatures -->
    <div class="signatures-section">
      <div class="signature-block">
        <div class="line"></div>
        <p>Firma Cliente</p>
      </div>
      <div class="signature-block">
        <div class="line"></div>
        <p>Firma Autorizada</p>
      </div>
    </div>

    <!-- Bottom Decoration Corner -->
    <div class="footer-decoration"></div>

    <!-- Disclaimer -->
    <div class="quote-disclaimer">
        Este documento no tiene validez fiscal y es únicamente para fines informativos de precios y disponibilidad.
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end" class="invoice-actions">
  <button printTitle="Cotización" [useExistingCss]="true"  printSectionId="quoteData" ngxPrint class="btn btn-primary" data-mdb-ripple-color="dark">
    <i class="fas fa-print"></i> Imprimir / Guardar
  </button>
  <button class="btn btn-danger" type="button" mat-dialog-close>
      Cerrar
  </button>
</mat-dialog-actions>
